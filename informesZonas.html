<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Informe de Zona - Bomberos</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body {
    font-family: "Times New Roman", Times, serif;
    margin: 20px;
    background-color: #031626;
    color: #333;
}
h1 {
    text-align: center;
    font-size: 24px;
    font-weight: bold;
    color: #c94031;
    margin-bottom: 30px;
}
label { display:block; margin-top:12px; font-weight:bold; }
input, textarea, select {
    width:100%; max-width:600px; padding:8px; margin-top:5px;
    border:1px solid #ccc; border-radius:4px; font-size:14px;
}
button {
    margin-top:20px; padding:12px 24px; background-color:#c94031; color:white;
    font-size:16px; border:none; border-radius:4px; cursor:pointer;
}
button:hover { background-color:#e04b3b; }
.form-container {
    background-color:#fff; border:1px solid #ddd; padding:20px;
    box-shadow:0 2px 10px rgba(0,0,0,0.1); border-radius:8px; margin-top:30px;
}
canvas {
    border:1px solid #000; touch-action:none; max-width:100%; height:200px;
    display:block; margin:10px auto;
}
</style>
</head>
<body>
<h1>Informe de Zona</h1>
<div class="form-container">
<form id="informeZonaForm">

<label>Número de informe (automático):
<input type="text" id="numInformeZona" readonly></label>

<label>Nombre del responsable de zona:
<input type="text" id="responsable" required></label>

<label>Número de brigadas activas:
<input type="number" id="numBrigadas" min="0" value="1"></label>

<label>Fecha del informe:
<input type="date" id="fechaZona" required></label>

<label>Zona / Sector:
<input type="text" id="zona" required></label>

<label>Prioridad de la zona:
<select id="prioridad">
<option>Baja</option>
<option>Media</option>
<option>Alta</option>
<option>Crítica</option>
</select></label>

<label>Incidencias destacadas:
<textarea id="incidenciasDestacadas" rows="4" required></textarea></label>

<label>Medidas adoptadas / acciones coordinadas:
<textarea id="acciones" rows="4" required></textarea></label>

<label>Observaciones generales:
<textarea id="observacionesGenerales" rows="3"></textarea></label>

<label>Firma del responsable (dibujar en pantalla):</label>
<canvas id="firmaCanvasZona" width="600" height="200"></canvas>
<button type="button" onclick="limpiarFirmaZona()">Limpiar firma</button>

<label>Pie de firma:
<input type="text" id="pieFirmaZona" placeholder="Ej: Jefe de Zona"></label>

<label>Contraseña para generar PDF:
<input type="password" id="contrasenaZona" placeholder="Introduce la contraseña"></label>

<br>
<button type="button" onclick="verificarYGenerarPDF()">Descargar PDF</button>
</form>
</div>

<script>
document.addEventListener('DOMContentLoaded',()=>{
    const hoy=new Date();
    const num="ZNA-INF-"+hoy.getFullYear()+String(hoy.getMonth()+1).padStart(2,'0')+String(hoy.getDate()).padStart(2,'0')+"-"+Math.floor(Math.random()*10000);
    document.getElementById("numInformeZona").value=num;
});

function limpiarFirmaZona(){
    const canvas=document.getElementById("firmaCanvasZona");
    const ctx=canvas.getContext("2d");
    ctx.clearRect(0,0,canvas.width,canvas.height);
}

const canvasZona=document.getElementById("firmaCanvasZona");
const ctxZona=canvasZona.getContext("2d");
let dibujandoZona=false;

const iniciarDibujoZona=(x,y)=>{dibujandoZona=true;ctxZona.beginPath();ctxZona.moveTo(x,y);}
const trazarLineaZona=(x,y)=>{if(!dibujandoZona) return; ctxZona.lineTo(x,y); ctxZona.stroke();}
const detenerDibujoZona=()=>{dibujandoZona=false;ctxZona.closePath();}

canvasZona.addEventListener("mousedown",e=>iniciarDibujoZona(e.offsetX,e.offsetY));
canvasZona.addEventListener("mousemove",e=>trazarLineaZona(e.offsetX,e.offsetY));
canvasZona.addEventListener("mouseup",detenerDibujoZona);
canvasZona.addEventListener("mouseout",detenerDibujoZona);
canvasZona.addEventListener("touchstart",e=>{e.preventDefault(); const rect=canvasZona.getBoundingClientRect(); const touch=e.touches[0]; iniciarDibujoZona(touch.clientX-rect.left, touch.clientY-rect.top);});
canvasZona.addEventListener("touchmove",e=>{e.preventDefault(); const rect=canvasZona.getBoundingClientRect(); const touch=e.touches[0]; trazarLineaZona(touch.clientX-rect.left, touch.clientY-rect.top);});
canvasZona.addEventListener("touchend",detenerDibujoZona);

function verificarYGenerarPDF(){
    const pass=document.getElementById("contrasenaZona").value;
    // Aquí puedes cambiar la contraseña
    if(pass==="Zona!2025"){
        generarInformeZonaPDF();
    } else {
        alert("⚠️ Contraseña incorrecta. No se generó el informe.");
    }
}

async function generarInformeZonaPDF(){
    const {jsPDF}=window.jspdf;
    const doc=new jsPDF();

    const informe=document.getElementById("numInformeZona").value;
    const responsable=document.getElementById("responsable").value;
    const numBrigadas=document.getElementById("numBrigadas").value;
    const fecha=document.getElementById("fechaZona").value;
    const zona=document.getElementById("zona").value;
    const prioridad=document.getElementById("prioridad").value;
    const incidenciasDestacadas=document.getElementById("incidenciasDestacadas").value;
    const acciones=document.getElementById("acciones").value;
    const observacionesGenerales=document.getElementById("observacionesGenerales").value;
    const pieFirma=document.getElementById("pieFirmaZona").value;

    doc.setFontSize(16); doc.setFont("times","bold");
    doc.text("Informe de Zona - Bomberos",20,20);
    doc.setFontSize(14); doc.text(`Informe: ${informe}`,20,30);
    doc.setFontSize(12); doc.setFont("times","normal");
    doc.text(`Fecha: ${fecha}`,20,40);
    doc.text(`Responsable: ${responsable}`,20,50);
    doc.text(`Número de brigadas activas: ${numBrigadas}`,20,60);
    doc.text(`Zona / Sector: ${zona}`,20,70);
    doc.text(`Prioridad: ${prioridad}`,20,80);

    let altura=90;
    doc.setFont("times","bold"); doc.text("Incidencias destacadas:",20,altura);
    altura+=8; doc.setFont("times","normal");
    doc.text(doc.splitTextToSize(incidenciasDestacadas,170),20,altura); altura+=doc.splitTextToSize(incidenciasDestacadas,170).length*7+5;

    doc.setFont("times","bold"); doc.text("Medidas adoptadas / acciones coordinadas:",20,altura);
    altura+=8; doc.setFont("times","normal");
    doc.text(doc.splitTextToSize(acciones,170),20,altura); altura+=doc.splitTextToSize(acciones,170).length*7+5;

    if(observacionesGenerales.trim()){
        doc.setFont("times","bold"); doc.text("Observaciones generales:",20,altura);
        altura+=8; doc.setFont("times","normal");
        doc.text(doc.splitTextToSize(observacionesGenerales,170),20,altura);
        altura+=doc.splitTextToSize(observacionesGenerales,170).length*7+5;
    }

    doc.text("Firma del responsable:",20,altura+20);
    const firmaCanvas=document.getElementById("firmaCanvasZona");
    const firmaImg=firmaCanvas.toDataURL("image/png");
    doc.addImage(firmaImg,"PNG",60,altura+20,100,40);

    if(pieFirma.trim()){ doc.text(`PD. ${pieFirma}`,20,altura+70); }

    doc.save(`Informe_Zona_${informe}.pdf`);
}
</script>
</body>
</html>
