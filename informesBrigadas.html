<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Informe Brigada - Bomberos</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body {
    font-family: "Times New Roman", Times, serif;
    margin: 20px;
    background-color: #031626;
    color: #333;
}
h1 {
    text-align: center;
    font-size: 24px;
    font-weight: bold;
    color: #c94031;
    margin-bottom: 30px;
}
label { display:block; margin-top:12px; font-weight:bold; }
input, textarea, select {
    width:100%; max-width:600px; padding:8px; margin-top:5px;
    border:1px solid #ccc; border-radius:4px; font-size:14px;
}
button {
    margin-top:20px; padding:12px 24px; background-color:#c94031; color:white;
    font-size:16px; border:none; border-radius:4px; cursor:pointer;
}
button:hover { background-color:#e04b3b; }
.form-container {
    background-color:#fff; border:1px solid #ddd; padding:20px;
    box-shadow:0 2px 10px rgba(0,0,0,0.1); border-radius:8px; margin-top:30px;
}
canvas {
    border:1px solid #000; touch-action:none; max-width:100%; height:200px;
    display:block; margin:10px auto;
}
</style>
</head>
<body>
<h1>Informe Brigada</h1>
<div class="form-container">
<form id="informeForm">

<label>Número de informe (automático):
<input type="text" id="numInforme" readonly></label>

<label>Nombre del agente:
<input type="text" id="agente" required></label>

<label>Número de placa:
<input type="text" id="placa" required></label>

<label>Fecha del informe:
<input type="date" id="fecha" required></label>

<label>Lugar del incidente / situación:
<input type="text" id="lugar" required></label>

<label>Tipo de incidente:
<select id="tipoIncidente">
<option>Fuego</option>
<option>Accidente</option>
<option>Rescate</option>
<option>Evacuación</option>
<option>Otro</option>
</select></label>

<label>Número de víctimas:
<input type="number" id="numVictimas" min="0" value="0"></label>

<label>Gravedad:
<select id="gravedad">
<option>Baja</option>
<option>Media</option>
<option>Alta</option>
</select></label>

<label>Descripción detallada de los hechos / situación:
<textarea id="hechos" rows="4" required></textarea></label>

<label>Evidencias / Pruebas (si aplica):
<textarea id="pruebas" rows="3"></textarea></label>

<label>Duración de la intervención:
<input type="time" id="horaInicio"> a <input type="time" id="horaFin"></label>

<label>Recursos utilizados:
<textarea id="recursos" rows="2"></textarea></label>

<label>Estado final:
<select id="estadoFinal">
<option>Completada</option>
<option>Parcial</option>
<option>Cancelada</option>
</select></label>

<label>Observaciones de seguridad:
<textarea id="observacionesSeguridad" rows="3"></textarea></label>

<label>Firma del agente / superior (dibujar en pantalla):</label>
<canvas id="firmaCanvas" width="600" height="200"></canvas>
<button type="button" onclick="limpiarFirma()">Limpiar firma</button>

<label>Pie de firma:
<input type="text" id="pieFirma" placeholder="Ej: Jefe de Brigada"></label>

<label>Contraseña para generar PDF:
<input type="password" id="contrasena" placeholder="Introduce la contraseña"></label>

<br>
<button type="button" onclick="verificarYGenerarPDF()">Descargar PDF</button>
</form>
</div>

<script>
document.addEventListener('DOMContentLoaded',()=>{
    const hoy=new Date();
    const num="BRG-INF-"+hoy.getFullYear()+String(hoy.getMonth()+1).padStart(2,'0')+String(hoy.getDate()).padStart(2,'0')+"-"+Math.floor(Math.random()*10000);
    document.getElementById("numInforme").value=num;
});

function limpiarFirma(){
    const canvas=document.getElementById("firmaCanvas");
    const ctx=canvas.getContext("2d");
    ctx.clearRect(0,0,canvas.width,canvas.height);
}

const canvas=document.getElementById("firmaCanvas");
const ctx=canvas.getContext("2d");
let dibujando=false;
const iniciarDibujo=(x,y)=>{dibujando=true;ctx.beginPath();ctx.moveTo(x,y);}
const trazarLinea=(x,y)=>{if(!dibujando) return; ctx.lineTo(x,y); ctx.stroke();}
const detenerDibujo=()=>{dibujando=false;ctx.closePath();}
canvas.addEventListener("mousedown",e=>iniciarDibujo(e.offsetX,e.offsetY));
canvas.addEventListener("mousemove",e=>trazarLinea(e.offsetX,e.offsetY));
canvas.addEventListener("mouseup",detenerDibujo);
canvas.addEventListener("mouseout",detenerDibujo);
canvas.addEventListener("touchstart",e=>{e.preventDefault(); const rect=canvas.getBoundingClientRect(); const touch=e.touches[0]; iniciarDibujo(touch.clientX-rect.left, touch.clientY-rect.top);});
canvas.addEventListener("touchmove",e=>{e.preventDefault(); const rect=canvas.getBoundingClientRect(); const touch=e.touches[0]; trazarLinea(touch.clientX-rect.left, touch.clientY-rect.top);});
canvas.addEventListener("touchend",detenerDibujo);

function verificarYGenerarPDF(){
    const pass=document.getElementById("contrasena").value;
    // Cambia la contraseña según necesites
    if(pass==="Brigada!2025"){
        generarInformePDF();
    }else{
        alert("⚠️ Contraseña incorrecta. No se generó el informe.");
    }
}

async function generarInformePDF(){
    const {jsPDF}=window.jspdf;
    const doc=new jsPDF();

    const informe=document.getElementById("numInforme").value;
    const placa=document.getElementById("placa").value;
    const agente=document.getElementById("agente").value;
    const fecha=document.getElementById("fecha").value;
    const lugar=document.getElementById("lugar").value;
    const tipoIncidente=document.getElementById("tipoIncidente").value;
    const numVictimas=document.getElementById("numVictimas").value;
    const gravedad=document.getElementById("gravedad").value;
    const hechos=document.getElementById("hechos").value;
    const pruebas=document.getElementById("pruebas").value;
    const horaInicio=document.getElementById("horaInicio").value;
    const horaFin=document.getElementById("horaFin").value;
    const recursos=document.getElementById("recursos").value;
    const estadoFinal=document.getElementById("estadoFinal").value;
    const observacionesSeguridad=document.getElementById("observacionesSeguridad").value;
    const pieFirma=document.getElementById("pieFirma").value;

    doc.setFontSize(16); doc.setFont("times","bold");
    doc.text("Brigada de Bomberos",20,20);
    doc.setFontSize(14); doc.text(`Informe: ${informe}`,20,30);
    doc.setFontSize(12); doc.setFont("times","normal");
    doc.text(`Fecha: ${fecha}`,20,40);
    doc.text(`Agente: ${agente} (Placa: ${placa})`,20,50);
    doc.text(`Lugar: ${lugar}`,20,60);
    doc.text(`Tipo de incidente: ${tipoIncidente}`,20,70);
    doc.text(`Número de víctimas: ${numVictimas}`,20,80);
    doc.text(`Gravedad: ${gravedad}`,20,90);

    let altura=100;
    doc.setFont("times","bold"); doc.text("Descripción de los hechos / situación:",20,altura);
    altura+=8; doc.setFont("times","normal");
    doc.text(doc.splitTextToSize(hechos,170),20,altura); altura+=doc.splitTextToSize(hechos,170).length*7+5;

    if(pruebas.trim()){
        doc.setFont("times","bold"); doc.text("Evidencias / Pruebas:",20,altura);
        altura+=8; doc.setFont("times","normal");
        doc.text(doc.splitTextToSize(pruebas,170),20,altura); altura+=doc.splitTextToSize(pruebas,170).length*7+5;
    }

    doc.setFont("times","bold"); doc.text("Duración de la intervención:",20,altura);
    altura+=8; doc.setFont("times","normal");
    doc.text(`Desde ${horaInicio} hasta ${horaFin}`,20,altura);

    doc.setFont("times","bold"); doc.text("Recursos utilizados:",20,altura+10);
    altura+=8; doc.setFont("times","normal");
    doc.text(doc.splitTextToSize(recursos,170),20,altura); altura+=doc.splitTextToSize(recursos,170).length*7+5;

    doc.setFont("times","bold"); doc.text("Estado final:",20,altura); altura+=8;
    doc.setFont("times","normal"); doc.text(estadoFinal,20,altura); altura+=10;

    if(observacionesSeguridad.trim()){
        doc.setFont("times","bold"); doc.text("Observaciones de seguridad:",20,altura); altura+=8;
        doc.setFont("times","normal"); doc.text(doc.splitTextToSize(observacionesSeguridad,170),20,altura);
        altura+=doc.splitTextToSize(observacionesSeguridad,170).length*7+5;
    }

    doc.text("Firma del agente / superior:",20,altura+20);
    const firmaCanvas=document.getElementById("firmaCanvas");
    const firmaImg=firmaCanvas.toDataURL("image/png");
    doc.addImage(firmaImg,"PNG",60,altura+20,100,40);

    if(pieFirma.trim()){ doc.text(`PD. ${pieFirma}`,20,altura+70); }

    doc.save(`Informe_Brigada_${informe}.pdf`);
}
</script>
</body>
</html>
