<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>Credencial Bomberos</title>
<style>
body { 
  background:#0a0c0f; 
  color:#fff; 
  font-family:'Segoe UI', sans-serif; 
  padding:20px; 
}
.panel { 
  background:#161b22; 
  padding:20px; 
  border-radius:12px; 
  max-width:520px; 
  margin:auto; 
  box-shadow: 0 0 20px rgba(255,59,59,0.5);
}
h2 { 
  text-align:center; 
  color:#ff3b3b; 
  margin-bottom:15px; 
}
label { display:block; margin-top:10px; font-weight:bold; }
input, select { 
  width:100%; padding:10px; margin-top:5px; border-radius:6px; border:1px solid #30363d; 
  background:#0d1117; color:#fff; font-size:14px; 
}
button { 
  margin-top:12px; padding:12px 16px; border:0; border-radius:8px; 
  cursor:pointer; font-weight:bold; color:#fff; margin-right:5px; font-size:14px;
}
#generate { background:#ff3b3b; }
#generate:hover { background:#ff1a1a; }
#send { background:#ff6b3b; }
#send:hover { background:#ff4a1a; }
#download { background:#1a73e8; }
#download:hover { background:#0f5ec1; }
canvas { 
  display:block; margin:20px auto; background:#111; border-radius:12px; 
  box-shadow:0 0 20px rgba(255,59,59,0.5); 
}
</style>
</head>
<body>
<div class="panel">
<h2>Credencial Bomberos</h2>

<label>Nombre<input id="name" type="text" placeholder="Ej: Juan PÃ©rez"></label>
<label>Rango<input id="rank" type="text" placeholder="Ej: Cabo"></label>
<label>Unidad<input id="unit" type="text" placeholder="Ej: Parque Central"></label>
<label>NÃºmero de placa<input id="number" type="text" placeholder="Ej: B-1234"></label>
<label>Foto del bombero<input id="photo" type="file" accept="image/*"></label>
<label>Logo del parque<input id="logo" type="file" accept="image/*"></label>
<label>Fondo personalizado<input id="background" type="file" accept="image/*"></label>
<label>ID de usuario Discord<input id="discordId" type="text" placeholder="Ej: 123456789012345678"></label>

<button id="generate">Generar Credencial</button>
<button id="send">Enviar a Discord</button>
<button id="download">Descargar como Imagen</button>

<canvas id="badge" width="420" height="720"></canvas>
</div>

<script>
const canvas = document.getElementById("badge");
const ctx = canvas.getContext("2d");

const nameInput = document.getElementById("name");
const rankInput = document.getElementById("rank");
const unitInput = document.getElementById("unit");
const numInput = document.getElementById("number");
const photoInput = document.getElementById("photo");
const logoInput = document.getElementById("logo");
const backgroundInput = document.getElementById("background");
const discordIdInput = document.getElementById("discordId");

let photoImg=null, logoImg=null, backgroundImg=null;
const DISCORD_WEBHOOK = ""; // Inserta aquÃ­ tu webhook

function loadImage(file, callback){
  const reader = new FileReader();
  reader.onload = e=>{
    const img = new Image();
    img.onload = ()=>callback(img);
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

photoInput.addEventListener("change", e=>{ if(e.target.files[0]) loadImage(e.target.files[0], img=>{ photoImg=img; drawBadge(); }); });
logoInput.addEventListener("change", e=>{ if(e.target.files[0]) loadImage(e.target.files[0], img=>{ logoImg=img; drawBadge(); }); });
backgroundInput.addEventListener("change", e=>{ if(e.target.files[0]) loadImage(e.target.files[0], img=>{ backgroundImg=img; drawBadge(); }); });

function drawMetallicText(text,x,y,fontSize=28,center=false){
  const gradient=ctx.createLinearGradient(x,y-fontSize,x,y);
  gradient.addColorStop(0,"#fffacd");
  gradient.addColorStop(0.5,"#ffcc00");
  gradient.addColorStop(1,"#ff9900");
  ctx.fillStyle=gradient;
  ctx.font=`bold ${fontSize}px Arial`;
  ctx.textAlign=center?"center":"left";
  ctx.fillText(text,x,y);
}

function drawBadge(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Fondo
  if(backgroundImg) ctx.drawImage(backgroundImg,0,0,canvas.width,canvas.height);
  else { ctx.fillStyle="#1a1a1a"; ctx.fillRect(0,0,canvas.width,canvas.height); }

  // Cabecera
  ctx.fillStyle="#ff3b3b";
  ctx.fillRect(0,40,canvas.width,60);
  ctx.fillStyle="#fff";
  ctx.font="bold 22px Arial";
  ctx.textAlign="center";
  ctx.fillText("CUERPO DE BOMBEROS", canvas.width/2,75);

  // Foto
  if(photoImg) ctx.drawImage(photoImg,(canvas.width-140)/2,130,140,180);
  else { ctx.strokeStyle="#ccc"; ctx.strokeRect((canvas.width-140)/2,130,140,180); ctx.fillStyle="#fff"; ctx.textAlign="center"; ctx.fillText("Foto",canvas.width/2,220); }

  // Datos
  ctx.fillStyle="#fff"; ctx.font="18px Arial"; ctx.textAlign="left";
  let startY = 330;
  ctx.fillText("Nombre: " + (nameInput.value || "NOMBRE RP"), 40, startY);
  ctx.fillText("Rango: " + (rankInput.value || "RANGO RP"), 40, startY+30);
  ctx.fillText("Unidad: " + (unitInput.value || "UNIDAD RP"), 40, startY+60);
  ctx.fillText("Placa NÂº: " + (numInput.value || "0000"), 40, startY+90);

  // Logo
  if(logoImg) ctx.drawImage(logoImg,(canvas.width-150)/2,480,150,150);

  // Placa grande destacado
  drawMetallicText("NÂº " + (numInput.value || "0000"),canvas.width/2,canvas.height-20,36,true);
}

document.getElementById("generate").addEventListener("click",drawBadge);

document.getElementById("send").addEventListener("click", async () => {
  canvas.toBlob(async function(blob){
    const form = new FormData();
    form.append("file", blob, "credencial.png");

    const embed = {
      title: "ðŸªª Nueva credencial generada - Bomberos",
      color: 16724736,
      fields: [
        { name: "Nombre", value: nameInput.value || "NOMBRE RP", inline:true },
        { name: "Rango", value: rankInput.value || "RANGO RP", inline:true },
        { name: "Unidad", value: unitInput.value || "UNIDAD RP", inline:true },
        { name: "Placa NÂº", value: numInput.value || "0000", inline:true }
      ],
      image: { url:"attachment://credencial.png" },
      footer: { text:"Credencial Bomberos" }
    };

    const userId = discordIdInput.value.trim();
    const payload = { embeds:[embed], content: userId? `<@${userId}>`:"" };
    form.append("payload_json", JSON.stringify(payload));

    await fetch(DISCORD_WEBHOOK, { method:"POST", body: form });
    alert("Credencial enviada a Discord âœ…");
  });
});

// --- Descargar como imagen ---
document.getElementById("download").addEventListener("click", ()=>{
  const link = document.createElement("a");
  link.download = `credencial_bombero_${numInput.value || "0000"}.png`;
  link.href = canvas.toDataURL("image/png");
  link.click();
});

drawBadge();
</script>
</body>
</html>
